*представляет процесс обработки оплаты заказа. Управляет жизненным циклом платежа, обеспечивая корректную обработку статусов транзакции и валидацию данных.*

| Идентификатор            | Описание                                                   | СУБД проекция                    |
| ------------------------ | ---------------------------------------------------------- | -------------------------------- |
| [[Идентификатор оплаты]] |                                                            | UUID_v6                          |
| [[Идентификатор заказа]] |                                                            | UUID_v6, внешний ключ            |
| paymentMethod            | [[PaymentMethod]]                                          | type -> text<br>details -> jsonb |
| status                   | Текущий статус платежа (`Pending`, `Completed`, `Failed`). | text                             |
| completedTransaction     | [[PaymentTransaction]]                                     | UUID_v6, внешний ключ            |
| transactions             | Список [[PaymentTransaction]]                              | one to many                      |
|                          |                                                            |                                  |
## Инварианты агрегата

1. `Payment` всегда должен быть связан с конкретным `Order`.
2. `Payment` может находиться только в одном из следующих состояний: `Pending`, `Completed`, `Failed`.
3. `PaymentTransaction` для одного `Payment` не может быть успешной более одного раза.
4. При успешном `PaymentTransaction` статус `Payment` должен обновляться на `Completed`.
5. Если все попытки `PaymentTransaction` завершаются неудачей, `Payment` получает статус `Failed`.

## Взаимодействие с другими агрегатами

- **Order**: `Payment` ссылается на `Order` для подтверждения оплаты заказа.
- **Customer**: Может использовать данные платежных методов клиента.
- **Billing System**: `Payment` взаимодействует с внешней системой биллинга для обработки платежей.